<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="base(content)"
      lang="fr">

<head>
    <meta charset="UTF-8"/>
    <title th:text="${title} ?: #{site.name}">site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#77ca22',
                        secondary: '#1f2937'
                    }
                }
            }
        }
    </script>

    <!-- SwiperJS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
</head>

<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">

<!-- ================= HEADER ================= -->
<header class="sticky top-0 z-50 bg-white/90 backdrop-blur shadow">
    <div class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-between">

        <!-- LOGO -->
        <a th:href="@{/}"
           class="text-xl font-extrabold text-primary hover:scale-105 transition"
           th:text="#{site.name}">site</a>

        <!-- DESKTOP NAV -->
        <nav class="hidden md:flex items-center gap-5 text-sm font-medium">

            <a th:href="@{/ads}"
               class="hover:text-primary transition"
               th:text="#{nav.browse}">browse</a>

            <!-- CTA publier -->
            <a th:href="@{/ad/new}"
               class="bg-gradient-to-r from-primary to-green-600 text-white px-4 py-1.5 rounded-md shadow hover:scale-105 transition"
               th:text="#{nav.publish}">
            </a>

            <!-- LANG SWITCH (public) -->
            <div class="relative group">
                <div class="flex items-center gap-1 cursor-pointer hover:text-primary">
                    ğŸŒ <span th:text="${#locale.language.toUpperCase()}">FR</span>
                </div>

                <div class="absolute right-0 mt-1
              invisible opacity-0 group-hover:visible group-hover:opacity-100
              transition-opacity duration-150
              bg-white border rounded-lg shadow-lg z-50
              pointer-events-auto">
                    <a th:href="@{?(lang='fr')}" class="block px-4 py-2 hover:bg-gray-100">ğŸ‡«ğŸ‡· FranÃ§ais</a>
                    <a th:href="@{?(lang='de')}" class="block px-4 py-2 hover:bg-gray-100">ğŸ‡©ğŸ‡ª Deutsch</a>
                    <a th:href="@{?(lang='it')}" class="block px-4 py-2 hover:bg-gray-100">ğŸ‡®ğŸ‡¹ Italiano</a>
                    <a th:href="@{?(lang='en')}" class="block px-4 py-2 hover:bg-gray-100">ğŸ‡¬ğŸ‡§ English</a>
                </div>
            </div>


            <!-- AUTH CONNECTÃ‰ -->
            <div sec:authorize="isAuthenticated()" class="flex items-center gap-3">
                <a th:href="@{/profile}"
                   class="hover:underline"
                   th:text="${user.firstName + ' ' + user.lastName}">
                </a>

                <form th:action="@{/logout}" method="post">
                    <button class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md text-xs"
                            th:text="#{nav.logout}">
                    </button>
                </form>
            </div>

            <!-- AUTH INVITÃ‰ -->
            <div sec:authorize="!isAuthenticated()" class="flex gap-2">
                <a th:href="@{/login}"
                   class="px-3 py-1.5 rounded-md bg-primary text-white shadow"
                   th:text="#{nav.login}">
                </a>
                <a th:href="@{/register}"
                   class="px-3 py-1.5 rounded-md bg-gray-600 text-white shadow"
                   th:text="#{nav.register}">
                </a>
            </div>
        </nav>

        <!-- MOBILE BUTTON -->
        <button id="menu-btn" class="md:hidden p-2 rounded bg-gray-100">â˜°</button>
    </div>

    <!-- MOBILE MENU -->
    <nav id="mobile-menu" class="hidden md:hidden bg-white border-t shadow">
        <div class="flex flex-col p-4 gap-3 text-sm">

            <a th:href="@{/ads}"
               class="text-center border border-primary text-primary px-4 py-2 rounded-md font-semibold"
               th:text="#{nav.browse}">
            </a>

            <a th:href="@{/ad/new}"
               class="text-center bg-gradient-to-r from-primary to-green-600 text-white px-4 py-2 rounded-md shadow"
               th:text="#{nav.publish}">
            </a>

            <!-- LANG MOBILE -->
            <div class="flex justify-center gap-4 pt-2 border-t">
                <a th:href="@{?(lang='fr')}">ğŸ‡«ğŸ‡·</a>
                <a th:href="@{?(lang='de')}">ğŸ‡©ğŸ‡ª</a>
                <a th:href="@{?(lang='it')}">ğŸ‡®ğŸ‡¹</a>
                <a th:href="@{?(lang='en')}">ğŸ‡¬ğŸ‡§</a>
            </div>

            <!-- AUTH MOBILE -->
            <div sec:authorize="isAuthenticated()" class="flex justify-between items-center pt-3 border-t">
                <a th:href="@{/profile}"
                   class="font-semibold"
                   th:text="#{nav.profile}">
                </a>
                <form th:action="@{/logout}" method="post">
                    <button class="bg-red-500 text-white px-3 py-1 rounded-md text-xs"
                            th:text="#{nav.logout}">
                    </button>
                </form>
            </div>

            <div sec:authorize="!isAuthenticated()" class="flex gap-2 pt-3 border-t">
                <a th:href="@{/login}"
                   class="flex-1 text-center bg-primary text-white py-2 rounded-md"
                   th:text="#{nav.login}">
                </a>
                <a th:href="@{/register}"
                   class="flex-1 text-center bg-gray-600 text-white py-2 rounded-md"
                   th:text="#{nav.register}">
                </a>
            </div>
        </div>
    </nav>
</header>

<!-- ================= MAIN ================= -->
<main class="flex-grow max-w-7xl mx-auto px-4 py-8"
      th:insert="${content}">
</main>

<!-- ================= FOOTER ================= -->
<footer class="bg-gray-900 text-gray-400">
    <div class="max-w-7xl mx-auto px-6 py-10 grid grid-cols-1 md:grid-cols-4 gap-8 text-sm">

        <div>
            <h3 class="text-white font-bold text-lg mb-2" th:text="#{site.name}"></h3>
            <p th:text="#{footer.description}"></p>
        </div>

        <div>
            <h4 class="text-white font-semibold mb-2" th:text="#{footer.navigation}"></h4>
            <ul class="space-y-1">
                <li><a th:href="@{/}" class="hover:text-white" th:text="#{nav.home}"></a></li>
                <li><a th:href="@{/ads}" class="hover:text-white" th:text="#{nav.browse}"></a></li>
                <li><a th:href="@{/ad/new}" class="hover:text-white" th:text="#{nav.publish}"></a></li>
            </ul>
        </div>

        <div>
            <h4 class="text-white font-semibold mb-2" th:text="#{footer.legal}"></h4>
            <ul class="space-y-1">
                <li><a th:href="@{/legal/terms}" class="hover:text-white" th:text="#{footer.terms}"></a></li>
                <li><a th:href="@{/legal/privacy}" class="hover:text-white" th:text="#{footer.privacy}"></a></li>
            </ul>
        </div>

        <div>
            <h4 class="text-white font-semibold mb-2" th:text="#{footer.language}"></h4>
            <div class="flex gap-3">
                <a th:href="@{?(lang='fr')}">ğŸ‡«ğŸ‡·</a>
                <a th:href="@{?(lang='de')}">ğŸ‡©ğŸ‡ª</a>
                <a th:href="@{?(lang='it')}">ğŸ‡®ğŸ‡¹</a>
                <a th:href="@{?(lang='en')}">ğŸ‡¬ğŸ‡§</a>
            </div>
        </div>
    </div>

    <div class="border-t border-gray-800 text-center text-xs py-4"
         th:text="#{footer.copyright}">
    </div>
</footer>

<script>
    document.getElementById('menu-btn')
        .addEventListener('click', () =>
            document.getElementById('mobile-menu').classList.toggle('hidden')
        );
</script>

</body>
</html>
