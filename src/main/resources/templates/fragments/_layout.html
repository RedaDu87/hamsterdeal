<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="fr"
      th:fragment="base(content)">

<head>
  <meta charset="UTF-8" />
  <th:block th:if="${_csrf != null}">
  </th:block>

  <title th:text="${title} ?: 'Annonces'">Annonces</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#77ca22',
            secondary: '#1f2937'
          }
        }
      }
    }
  </script>

  <!-- SwiperJS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const swiperThumbs = new Swiper(".mySwiper", {
        loop: true,
        spaceBetween: 10,
        slidesPerView: 6,
        freeMode: true,
        watchSlidesProgress: true,
      });
      const swiperMain = new Swiper(".mySwiper2", {
        loop: true,
        spaceBetween: 10,
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
        thumbs: {
          swiper: swiperThumbs,
        },
      });
    });
  </script>

</head>

<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">

<header class="sticky top-0 z-50 bg-white/90 backdrop-blur shadow-md">
  <div class="container mx-auto px-4 py-1.5 flex justify-between items-center">

    <a class="text-xl font-extrabold text-primary hover:scale-105 transition" th:href="@{/}">
      HamsterDeal
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden md:flex items-center gap-4 text-sm font-medium">

      <!-- Bouton PARCOURIR LES ANNONCES -->
      <a th:href="@{/ads}"
         class="bg-white border border-primary text-primary px-3 py-1.5 rounded-md shadow hover:bg-primary hover:text-white transition font-semibold">
        Parcourir les annonces
      </a>

      <!-- Bouton D√©poser une annonce -->
      <!-- D√©poser une annonce -->
      <a th:if="${isAuthenticated}"
         th:href="@{/ad/new}"
         class="bg-gradient-to-r from-primary to-green-600 text-white px-3 py-1.5 rounded-md shadow hover:scale-105 transition">
        D√©poser une annonce
      </a>

      <!-- Version non connect√©e : redirection vers /login -->
      <a th:if="${!isAuthenticated}"
         th:href="@{/login}"
         class="bg-gradient-to-r from-primary to-green-600 text-white px-3 py-1.5 rounded-md shadow hover:scale-105 transition">
        D√©poser une annonce
      </a>

      <!-- Section utilisateur -->
      <div th:if="${isAuthenticated}" class="flex items-center gap-3">

        <a th:href="@{/profile}"
           class="font-medium hover:underline hover:text-primary transition"
           th:text="${user != null ? user.firstName + ' ' + user.lastName : 'Utilisateur'}">
        </a>


        <a th:href="@{/profile}" class="flex items-center">
          <div class="w-8 h-8 rounded-full overflow-hidden bg-primary text-white flex items-center justify-center font-bold shadow">
            <img th:if="${user != null and user.photoUrl != null}" th:src="@{${user.photoUrl}}" class="w-full h-full object-cover" />
            <span th:if="${user == null || user.photoUrl == null}" th:text="${user.firstName.substring(0,1)}"></span>
          </div>
        </a>

        <form th:action="@{/logout}" method="post">
          <button type="submit"
                  class="bg-red-500 hover:bg-red-600 text-white px-2.5 py-1 rounded-md shadow text-xs">
            D√©connexion
          </button>
        </form>

      </div>

      <!-- Invit√© -->
      <div th:if="${!isAuthenticated}" class="flex gap-2">
        <a th:href="@{/login}" class="bg-primary hover:bg-green-700 text-white px-3 py-1.5 rounded-md shadow text-sm">Connexion</a>
        <a th:href="@{/register}" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1.5 rounded-md shadow text-sm">Inscription</a>
      </div>

    </nav>


    <!-- Mobile button -->
    <button id="menu-btn" class="md:hidden p-1.5 rounded-md bg-gray-100 hover:bg-gray-200">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>
  </div>

  <!-- Mobile Nav -->
  <!-- Mobile Nav -->
  <nav id="mobile-menu" class="hidden md:hidden bg-white border-t shadow-lg">
    <div class="flex flex-col p-3 space-y-3 text-sm">

      <!-- üîç Bouton Parcourir les annonces (mis en valeur) -->
      <a th:href="@{/ads}"
         class="w-full text-center bg-white border border-primary text-primary
              px-3 py-2 rounded-md shadow hover:bg-primary hover:text-white
              transition font-semibold">
        Parcourir les annonces
      </a>

      <!-- ‚ûï Bouton D√©poser une annonce -->
      <!-- D√©poser une annonce -->
      <a th:if="${isAuthenticated}"
         th:href="@{/ad/new}"
         class="bg-gradient-to-r from-primary to-green-600 text-white px-3 py-1.5 rounded-md shadow hover:scale-105 transition">
        D√©poser une annonce
      </a>

      <!-- Version non connect√©e : redirection vers /login -->
      <a th:if="${!isAuthenticated}"
         th:href="@{/login}"
         class="bg-gradient-to-r from-primary to-green-600 text-white px-3 py-1.5 rounded-md shadow hover:scale-105 transition">
        D√©poser une annonce
      </a>

      <!-- üåü Utilisateur connect√© -->
      <div th:if="${isAuthenticated}" class="flex items-center gap-3 border-t pt-3">

        <a th:href="@{/profile}"
           class="w-10 h-10 rounded-full overflow-hidden bg-primary text-white
          flex items-center justify-center font-bold
          hover:opacity-90 transition">

          <!-- PHOTO -->
          <img th:if="${user != null and user.photoUrl != null}"
               th:src="@{${user.photoUrl}}"
               class="w-full h-full object-cover"/>

          <!-- LETTRE (fallback SAFE) -->
          <span th:if="${user != null and user.photoUrl == null}"
                th:text="${user.firstName != null ? user.firstName.substring(0,1) : 'U'}">
    </span>

          <!-- UTILISATEUR NULL (fallback extr√™me, safe) -->
          <span th:if="${user == null}">
        U
    </span>

        </a>


        <div class="flex flex-col">
          <a th:href="@{/profile}"
             class="font-semibold hover:underline hover:text-primary transition"
             th:text="${user != null ? user.firstName + ' ' + user.lastName : ''}">
          </a>

          <a th:href="@{/profile}"
             class="text-gray-500 text-xs hover:underline hover:text-primary transition"
             th:text="${user.email}">
          </a>

        </div>

        <form th:action="@{/logout}" method="post" class="ml-auto">
          <button type="submit"
                  class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md shadow text-xs">
            D√©connexion
          </button>
        </form>
      </div>

      <!-- üë§ Utilisateur non connect√© -->
      <div th:if="${!isAuthenticated}" class="flex gap-2 pt-3 border-t">
        <a th:href="@{/login}"
           class="bg-primary text-white px-3 py-2 rounded-md flex-1 text-center shadow text-sm">
          Connexion
        </a>
        <a th:href="@{/register}"
           class="bg-gray-600 text-white px-3 py-2 rounded-md flex-1 text-center shadow text-sm">
          Inscription
        </a>
      </div>

    </div>
  </nav>

</header>

<main class="container mx-auto px-4 py-8 flex-grow" th:insert="${content}"></main>

<footer class="bg-gradient-to-b from-gray-900 to-black text-gray-300 mt-16">
  <div class="max-w-7xl mx-auto px-6 py-14">

    <!-- TOP -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-10">

      <!-- BRAND -->
      <div>
        <h3 class="text-xl font-extrabold text-white mb-4">
          Annonces
        </h3>
        <p class="text-sm text-gray-400 leading-relaxed">
          La plateforme moderne pour publier, g√©rer et vendre
          vos annonces en toute simplicit√©, sur tous vos appareils.
        </p>

        <!-- APP STORES -->
        <div class="flex gap-3 mt-6">
          <a href="#"
             class="flex items-center gap-2 bg-black border border-gray-700
                              px-4 py-2 rounded-xl hover:border-white transition">
            <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
              <path d="M16.365 1.43c0 1.14-.42 2.04-1.24 2.77-.82.74-1.88 1.17-3.02 1.08-.06-1.05.45-2.09 1.23-2.83.79-.75 1.97-1.26 3.03-1.02z"/>
              <path d="M20.66 17.05c-.43.99-.95 1.91-1.57 2.77-.84 1.17-1.53 1.98-2.08 2.43-.86.74-1.79 1.12-2.79 1.12-.72 0-1.59-.2-2.61-.6-1.01-.4-1.94-.6-2.78-.6-.87 0-1.8.2-2.8.6-1 .4-1.81.62-2.43.65-.96.04-1.91-.35-2.86-1.17-.61-.53-1.33-1.43-2.16-2.71C.84 18.35 0 16.05 0 13.6c0-1.44.31-2.68.93-3.73.49-.85 1.15-1.52 1.98-2.01.83-.49 1.73-.74 2.7-.76.53 0 1.23.2 2.09.6.86.4 1.41.6 1.65.6.18 0 .78-.23 1.8-.69.96-.43 1.78-.61 2.45-.55 1.81.15 3.17.86 4.06 2.14-1.62.98-2.42 2.35-2.4 4.11.02 1.38.52 2.53 1.5 3.44.44.42.94.75 1.49.99-.12.35-.25.7-.41 1.05z"/>
            </svg>
            <span class="text-xs">
                            T√©l√©charger sur<br>
                            <strong class="text-white text-sm">App Store</strong>
                        </span>
          </a>

          <a href="#"
             class="flex items-center gap-2 bg-black border border-gray-700
                              px-4 py-2 rounded-xl hover:border-white transition">
            <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3.6 1.95l12.9 7.45-4.25 4.23L3.6 1.95zM1.3.75c-.3.3-.3.8-.3 1.4v19.7c0 .6 0 1.1.3 1.4l11.2-11.2L1.3.75zm18.8 10.3l-2.8-1.6-3.9 3.9 3.9 3.9 2.8-1.6c.5-.3.9-.7.9-1.4s-.4-1.1-.9-1.4z"/>
            </svg>
            <span class="text-xs">
                            Disponible sur<br>
                            <strong class="text-white text-sm">Google Play</strong>
                        </span>
          </a>
        </div>
      </div>

      <!-- NAV -->
      <div>
        <h4 class="text-white font-semibold mb-4">Navigation</h4>
        <ul class="space-y-2 text-sm">
          <li><a href="/" class="hover:text-white">Accueil</a></li>
          <li><a href="/ads" class="hover:text-white">Annonces</a></li>
          <li><a href="/profile" class="hover:text-white">Mon compte</a></li>
          <li><a href="/ad/new" class="hover:text-white">Publier une annonce</a></li>
          <li><a th:href="@{/hamster-game}" class="hover:text-white hover:underline">Mini-jeu Hamster</a></li>
        </ul>
      </div>

      <!-- LEGAL -->
      <div>
        <h4 class="text-white font-semibold mb-4">L√©gal</h4>
        <ul class="space-y-2 text-sm">
          <li><a href="/legal/terms" class="hover:text-white">Conditions g√©n√©rales</a></li>
          <li><a href="/legal/privacy" class="hover:text-white">Politique de confidentialit√©</a></li>
          <li><a href="/legal/cookies" class="hover:text-white">Cookies</a></li>
          <li><a href="/contact" class="hover:text-white">Contact</a></li>
        </ul>
      </div>

      <!-- SOCIAL -->
      <div>
        <h4 class="text-white font-semibold mb-4">Suivez-nous</h4>
        <div class="flex gap-4">
          <a href="#" class="hover:text-white transition">Facebook</a>
          <a href="#" class="hover:text-white transition">Twitter</a>
          <a href="#" class="hover:text-white transition">Instagram</a>
          <a href="#" class="hover:text-white transition">LinkedIn</a>
        </div>
      </div>

    </div>

    <!-- BOTTOM -->
    <div class="border-t border-gray-800 mt-12 pt-6
                    flex flex-col sm:flex-row justify-between items-center text-xs text-gray-500">
      <p>
        ¬© [[${#dates.format(#dates.createNow(),'yyyy')}]] ‚Äî Annonces. Tous droits r√©serv√©s.
      </p>
      <p class="mt-2 sm:mt-0">
        Con√ßu avec ‚ù§Ô∏è pour une exp√©rience moderne
      </p>
    </div>
  </div>
</footer>


<script>
  document.getElementById("menu-btn").addEventListener("click", () =>
          document.getElementById("mobile-menu").classList.toggle("hidden")
  );
</script>

</body>
</html>
