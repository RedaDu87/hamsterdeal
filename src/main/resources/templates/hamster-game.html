<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Runner Rush ‚Äì Impossible Mode üéÆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at top, #7dd3fc, #e0f2fe);
            font-family: system-ui, sans-serif;
        }

        .game {
            width: min(1200px, 96vw);
            background: white;
            border-radius: 26px;
            overflow: hidden;
            box-shadow: 0 40px 120px rgba(0, 0, 0, .4);
        }

        header {
            background: linear-gradient(90deg, #020617, #1e293b);
            color: white;
            padding: 14px 22px;
            display: flex;
            justify-content: space-between;
        }

        header h1 {
            margin: 0;
            font-size: 18px;
            font-weight: 900;
        }

        .hud {
            display: flex;
            gap: 14px;
        }

        .badge {
            background: rgba(255, 255, 255, .15);
            padding: 6px 14px;
            border-radius: 999px;
            font-weight: 800;
        }

        canvas {
            width: 100%;
            display: block;
        }

        .overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card {
            background: rgba(255, 255, 255, .95);
            border-radius: 18px;
            padding: 26px 30px;
            text-align: center;
            font-weight: 900;
            box-shadow: 0 30px 80px rgba(0, 0, 0, .35);
        }

        .hidden {
            display: none
        }
    </style>
</head>

<body>

<div class="game">
    <header>
        <h1>Runner Rush ‚ò†Ô∏è Impossible</h1>
        <div class="hud">
            <div class="badge">Score <span id="score">0</span></div>
            <div class="badge">Best <span id="best">0</span></div>
        </div>
    </header>

    <div style="position:relative">
        <canvas id="game"></canvas>

        <div id="start" class="overlay">
            <div class="card">
                ESPACE / TAP ‚Üí SAUT<br>
                Bonne chance üòà
            </div>
        </div>

        <div id="gameover" class="overlay hidden">
            <div class="card" style="color:#dc2626">
                GAME OVER<br><br>
                Clique pour recommencer
            </div>
        </div>
    </div>
</div>

<script>
    (() => {

        /* ===========================
           AUDIO SYSTEM
        =========================== */
        let audioCtx = null;
        let musicTimer = null;
        let musicStep = 0;
        let currentTheme = 0;

        const THEMES = [
            [523, 659, 784, 880, 784, 659],
            [659, 784, 880, 988, 880, 784],
            [523, 587, 659, 784, 659, 587],
            [784, 880, 988, 880, 784, 659]
        ];

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playTone(freq, dur = 0.12, vol = 0.08, type = "square", delay = 0) {
            if (!audioCtx) return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = type;
            o.frequency.value = freq;
            g.gain.value = vol;
            o.connect(g).connect(audioCtx.destination);
            o.start(audioCtx.currentTime + delay);
            o.stop(audioCtx.currentTime + delay + dur);
        }

        function startMusic() {
            stopMusic();
            initAudio();
            musicStep = 0;
            currentTheme = Math.floor(Math.random() * THEMES.length);

            musicTimer = setInterval(() => {
                const theme = THEMES[currentTheme];
                playTone(theme[musicStep % theme.length], 0.12, 0.06, "square");
                playTone(theme[musicStep % theme.length] / 2, 0.18, 0.04, "triangle");
                musicStep++;

                if (musicStep % 32 === 0) {
                    currentTheme = Math.floor(Math.random() * THEMES.length);
                }
            }, 140);
        }

        function stopMusic() {
            if (musicTimer) {
                clearInterval(musicTimer);
                musicTimer = null;
            }
        }

        function jumpSound() {
            initAudio();
            playTone(880, 0.08, 0.1, "square");
        }

        function gameOverSound() {
            initAudio();
            [392, 330, 262].forEach((f, i) => playTone(f, 0.3, 0.12, "sawtooth", i * 0.15));
        }

        /* ===========================
           CANVAS
        =========================== */
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");

        function resize() {
            const w = canvas.parentElement.clientWidth;
            const h = Math.max(480, w * 0.45);
            const dpr = Math.min(2, devicePixelRatio || 1);
            canvas.width = w * dpr;
            canvas.height = h * dpr;
            canvas.style.width = w + "px";
            canvas.style.height = h + "px";
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        window.addEventListener("resize", resize);
        resize();

        /* ===========================
           UI / STATE
        =========================== */
        const scoreEl = document.getElementById("score");
        const bestEl = document.getElementById("best");
        const startEl = document.getElementById("start");
        const gameoverEl = document.getElementById("gameover");

        let best = Number(localStorage.getItem("runner_best") || 0);
        bestEl.textContent = best;

        let running = false, dead = false;
        let time = 0, score = 0;
        let speed = 8;
        const groundY = () => canvas.clientHeight - 70;

        /* ===========================
           BACKGROUND (FAST PARALLAX)
        =========================== */
        function drawBackground() {
            ctx.fillStyle = "#7dd3fc";
            ctx.fillRect(0, 0, canvas.clientWidth, canvas.clientHeight);

            ctx.fillStyle = "#38bdf8";
            for (let i = 0; i < 8; i++) {
                const x = i * 240 - (time * 1.2) % 240;
                ctx.beginPath();
                ctx.arc(x + 60, 100, 30, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.fillStyle = "#60a5fa";
            for (let i = 0; i < 8; i++) {
                const x = i * 280 - (time * 0.7) % 280;
                ctx.beginPath();
                ctx.moveTo(x, groundY());
                ctx.lineTo(x + 140, groundY() - 140);
                ctx.lineTo(x + 280, groundY());
                ctx.fill();
            }
        }

        /* ===========================
           PLAYER
        =========================== */
        const player = {
            x: 140, y: 0, vy: 0, w: 34, h: 58, jumps: 0, frame: 0,
            update() {
                this.vy += 1.1;
                this.y += this.vy;
                if (this.y >= groundY() - this.h) {
                    this.y = groundY() - this.h;
                    this.vy = 0;
                    this.jumps = 0;
                }
                this.frame += 0.4;
            },
            jump() {
                if (this.jumps < 2) {
                    this.vy = -18;
                    this.jumps++;
                    jumpSound();
                }
            },
            draw() {
                const f = Math.floor(this.frame) % 2;
                ctx.save();
                ctx.translate(this.x, this.y);

                ctx.fillStyle = "#fde68a";
                ctx.beginPath();
                ctx.arc(this.w / 2, 12, 12, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = "#ef4444";
                ctx.fillRect(8, 24, this.w - 16, 24);

                ctx.strokeStyle = "#020617";
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.moveTo(8, 32);
                ctx.lineTo(f ? 0 : 16, 48);
                ctx.moveTo(this.w - 8, 32);
                ctx.lineTo(f ? this.w + 6 : this.w - 16, 48);
                ctx.moveTo(10, 46);
                ctx.lineTo(f ? 0 : 16, 68);
                ctx.moveTo(this.w - 10, 46);
                ctx.lineTo(f ? this.w + 4 : this.w - 16, 68);
                ctx.stroke();

                ctx.restore();
            }
        };

        /* ===========================
           OBSTACLES
        =========================== */
        const obstacles = [];

        function spawnObstacle() {
            const h = 60 + Math.random() * 120;
            obstacles.push({x: canvas.clientWidth + 30, y: groundY() - h, w: 34, h});
        }

        /* ===========================
           INPUT
        =========================== */
        function action() {
            if (dead) start();
            if (!running) start();
            player.jump();
        }

        document.addEventListener("keydown", e => {
            if (e.code === "Space" || e.code === "ArrowUp") action();
        });
        canvas.addEventListener("pointerdown", action);

        /* ===========================
           LOOP (IMPOSSIBLE SPEED)
        =========================== */
        function loop() {
            drawBackground();

            ctx.fillStyle = "#14532d";
            ctx.fillRect(0, groundY(), canvas.clientWidth, 5);

            if (!running) {
                player.draw();
                requestAnimationFrame(loop);
                return;
            }

            time++;
            score++;
            scoreEl.textContent = score;

            // üî• ACC√âL√âRATION FOLLE
            speed = 8 + score / 120;

            if (time % Math.max(30, 90 - score / 20) === 0) {
                spawnObstacle();
            }

            player.update();
            obstacles.forEach(o => o.x -= speed);
            while (obstacles.length && obstacles[0].x < -80) obstacles.shift();

            for (const o of obstacles) {
                if (hit(player, o)) die();
                ctx.fillStyle = "#020617";
                ctx.fillRect(o.x, o.y, o.w, o.h);
            }

            player.draw();
            requestAnimationFrame(loop);
        }

        function die() {
            running = false;
            dead = true;
            gameoverEl.classList.remove("hidden");
            stopMusic();
            gameOverSound();
            if (score > best) {
                best = score;
                localStorage.setItem("runner_best", best);
                bestEl.textContent = best;
            }
        }

        function start() {
            obstacles.length = 0;
            score = time = 0;
            dead = false;
            running = true;
            startEl.classList.add("hidden");
            gameoverEl.classList.add("hidden");
            startMusic();
        }

        /* ===========================
           UTILS
        =========================== */
        function hit(a, b) {
            return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
        }

        requestAnimationFrame(loop);
    })();
</script>

</body>
</html>
