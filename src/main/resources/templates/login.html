<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr"
      th:replace="~{fragments/_layout :: base(~{::body})}">
<head>
    <meta charset="UTF-8">
    <title th:text="#{login.page.title}">Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-orange-100 via-yellow-50 to-pink-100">

<main class="flex items-center justify-center min-h-[calc(100vh-8rem)] px-4">
    <div class="w-full max-w-md bg-white rounded-2xl shadow-2xl p-8 relative">

        <!-- Hamster -->
        <div class="flex flex-col items-center mb-8">
            <div class="relative w-24 h-24">
                <div class="absolute inset-0 bg-yellow-400 rounded-full shadow-lg"></div>
                <div class="absolute -top-3 left-4 w-6 h-6 bg-yellow-400 rounded-full"></div>
                <div class="absolute -top-3 right-4 w-6 h-6 bg-yellow-400 rounded-full"></div>

                <div class="absolute top-8 left-5 w-6 h-6 bg-white rounded-full flex items-center justify-center overflow-hidden">
                    <div id="eye-left" class="w-3 h-3 bg-black rounded-full transition-transform duration-75"></div>
                </div>
                <div class="absolute top-8 right-5 w-6 h-6 bg-white rounded-full flex items-center justify-center overflow-hidden">
                    <div id="eye-right" class="w-3 h-3 bg-black rounded-full transition-transform duration-75"></div>
                </div>
            </div>

            <h1 class="mt-4 text-xl font-bold text-gray-700"
                th:text="#{login.title}">
            </h1>

            <p class="text-gray-500 text-sm"
               th:text="#{login.subtitle}">
            </p>
        </div>

        <!-- Formulaire -->
        <form id="loginForm" class="space-y-4">
            <label class="block">
                <span class="font-medium text-gray-700"
                      th:text="#{login.email.label}">
                </span>
                <input type="email" name="email" required
                       class="w-full p-3 border rounded-lg mt-1 focus:ring-2 focus:ring-orange-500"/>
            </label>

            <label class="block">
                <span class="font-medium text-gray-700"
                      th:text="#{login.password.label}">
                </span>
                <input id="passwordField" type="password" name="password" required
                       class="w-full p-3 border rounded-lg mt-1 focus:ring-2 focus:ring-orange-500"/>
            </label>

            <button type="submit"
                    class="w-full py-3 rounded-lg font-semibold text-white
                           bg-gradient-to-r from-orange-500 to-red-500
                           shadow-lg hover:scale-[1.02] transform transition"
                    th:text="#{login.submit}">
            </button>
        </form>

        <!-- Lien inscription -->
        <p class="mt-6 text-center text-sm text-gray-600">
            <span th:text="#{login.noAccount}"></span>
            <a th:href="@{/register}"
               class="text-orange-600 font-semibold hover:underline"
               th:text="#{login.register}">
            </a>
        </p>
    </div>
</main>

<script th:inline="javascript">
    /*<![CDATA[*/
    const loginErrorMsg = /*[[#{login.error}]]*/ 'Error';
    /*]]>*/
</script>

<script>
    // Login
    const form = document.getElementById('loginForm');
    form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const data = new FormData(form);
        const res = await fetch('/api/auth/login', {
            method:'POST',
            body: data,
            credentials:'include'
        });
        if(res.ok) {
            window.location = '/';
        } else {
            alert(loginErrorMsg);
        }
    });

    // Yeux
    const eyes = [
        document.getElementById('eye-left'),
        document.getElementById('eye-right')
    ];

    document.addEventListener('mousemove', (e) => {
        const { innerWidth, innerHeight } = window;
        const x = (e.clientX / innerWidth - 0.5) * 20;
        const y = (e.clientY / innerHeight - 0.5) * 20;
        eyes.forEach(eye => {
            eye.style.transform = `translate(${x}px, ${y}px)`;
        });
    });

    // Fermeture des yeux au focus mot de passe
    const pwdField = document.getElementById('passwordField');
    pwdField.addEventListener('focus', () => {
        eyes.forEach(eye => {
            eye.style.width = "80%";
            eye.style.height = "2px";
            eye.style.borderRadius = "2px";
            eye.style.transform = "translate(0, 8px)";
        });
    });

    pwdField.addEventListener('blur', () => {
        eyes.forEach(eye => {
            eye.style.width = "0.75rem";
            eye.style.height = "0.75rem";
            eye.style.borderRadius = "9999px";
            eye.style.transform = "translate(0, 0)";
        });
    });
</script>

</body>
</html>
